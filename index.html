<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Navglid – Smart Navigation Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
body,html{margin:0;height:100%;font-family:Arial}
#map{height:100%;width:100%}
#toolbar{
position:fixed;bottom:10px;left:50%;transform:translateX(-50%);
background:#111;color:#fff;border-radius:12px;
padding:8px;display:flex;gap:8px;z-index:9999
}
#toolbar button,select{padding:6px;border-radius:6px;border:none}
#info{
position:fixed;top:10px;left:50%;transform:translateX(-50%);
background:#000c;color:#fff;padding:6px 12px;border-radius:8px;z-index:9999
}
#areaValue,#distValue{margin-top:4px;font-size:13px}
.collapsed{height:26px;overflow:hidden}
</style>
</head>
<body>
<div id="map"></div>

<div id="info">
<span id="gps">Detecting GPS...</span><br>
Lat:<span id="lat">--</span> Lng:<span id="lng">--</span><br>
Alt:<span id="alt">--</span> Speed:<span id="spd">--</span>
<div id="areaValue">Area: 0</div>
<div id="distValue">Distance: 0</div>
</div>

<div id="toolbar">
<button id="toggle">▼</button>
<select id="style"></select>
<button id="addMarker">Add Marker</button>
<button id="clearMarker">Clear</button>
<button id="distBtn">Distance</button>
<button id="areaBtn">Area</button>
<button id="finishArea">Finish</button>
<button id="clearArea">Clear Area</button>
<button id="unit">KM</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-geometryutil"></script>
<script>
/* MAP INIT */
const map=L.map('map',{zoomControl:true}).setView([20,78],5);

/* MAP STYLES */
const layers={
Street:L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
Satellite:L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
Hybrid:L.layerGroup([
L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{opacity:.5})
]),
Terrain:L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png'),
Dark:L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_dark/{z}/{x}/{y}{r}.png'),
Light:L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png')
};

layers.Street.addTo(map);

const styleSel=document.getElementById('style');
Object.keys(layers).forEach(k=>{
let o=document.createElement('option');o.value=k;o.text=k;styleSel.appendChild(o);
});

styleSel.onchange=()=>{
Object.values(layers).forEach(l=>map.removeLayer(l));
layers[styleSel.value].addTo(map);
};

/* GPS */
let userMarker;
if(navigator.geolocation){
navigator.geolocation.watchPosition(p=>{
let{latitude,longitude,altitude,speed,accuracy}=p.coords;
map.setView([latitude,longitude],16);
userMarker?
userMarker.setLatLng([latitude,longitude]):
userMarker=L.marker([latitude,longitude]).addTo(map);

lat.textContent=latitude.toFixed(5);
lng.textContent=longitude.toFixed(5);
alt.textContent=altitude?altitude.toFixed(1):"--";
spd.textContent=speed?(speed*3.6).toFixed(1)+' km/h':'0';
gps.textContent="GPS Active";
},e=>gps.textContent="GPS Blocked",{enableHighAccuracy:true});
}

/* TOOLBAR COLLAPSE */
const tb=document.getElementById('toolbar');
toggle.onclick=()=>tb.classList.toggle('collapsed');

/* MARKER */
let marks=[];
addMarker.onclick=()=>{
if(!userMarker)return;
let m=L.marker(userMarker.getLatLng()).addTo(map);
marks.push(m);
};
clearMarker.onclick=()=>{marks.forEach(m=>map.removeLayer(m));marks=[]};

/* DISTANCE */
let dPts=[],dLine;
distBtn.onclick=()=>{
if(!userMarker)return;
let p=userMarker.getLatLng();
dPts.push(p);
dLine&&map.removeLayer(dLine);
dLine=L.polyline(dPts,{color:'blue'}).addTo(map);
calcDist();
};
function calcDist(){
let d=0;
for(let i=1;i<dPts.length;i++)
d+=map.distance(dPts[i-1],dPts[i]);
distValue.innerHTML="Distance: "+formatDist(d);
}

/* AREA TOOL */
let areaPts=[],areaPoly,areaMarkers=[],areaFinished=false;
areaBtn.onclick=()=>{
if(!userMarker||areaFinished)return;
let p=userMarker.getLatLng();
areaPts.push(p);
let m=L.marker(p,{draggable:true}).addTo(map);
m.on('drag',()=>{
let i=areaMarkers.indexOf(m);
areaPts[i]=m.getLatLng();
updateArea(false);
});
areaMarkers.push(m);
updateArea(false);
};

finishArea.onclick=()=>{
if(areaPts.length<3)return;
areaFinished=true;
updateArea(true);
};

clearArea.onclick=()=>{
areaPts=[];areaFinished=false;
areaMarkers.forEach(m=>map.removeLayer(m));
areaMarkers=[];
areaPoly&&map.removeLayer(areaPoly);
areaValue.innerHTML='Area: 0';
};

function updateArea(final){
areaPoly&&map.removeLayer(areaPoly);
areaPoly=L.polygon(areaPts,{color:final?'red':'green',fillOpacity:.25}).addTo(map);
if(areaPts.length>=3){
let a=L.GeometryUtil.geodesicArea(areaPts);
areaValue.innerHTML=(final?'FINAL AREA: ':'Live Area: ')+formatArea(a);
}
}

/* UNIT TOGGLE */
let unit='km';
unit.onclick=()=>{
unit=unit==='km'?'mi':'km';
unit.textContent=unit.toUpperCase();
calcDist();
if(areaPts.length>=3)updateArea(areaFinished);
};

function formatDist(m){
return unit==='km'?(m/1000).toFixed(3)+' km':(m/1609).toFixed(3)+' mi';
}

function formatArea(a){
return unit==='km'?(a/1e6).toFixed(3)+' km²':(a/2589988).toFixed(3)+' mi²';
}
</script>
</body>
</html>
