<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Navglid</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body {
  margin: 0;
  height: 100%;
  font-family: system-ui, sans-serif;
}

#map {
  height: 100%;
  width: 100%;
}

/* Top Info Bar */
#infoBar {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.75);
  color: #fff;
  padding: 8px 14px;
  border-radius: 10px;
  font-size: 13px;
  z-index: 1000;
}

/* Speedometer */
#speed {
  position: absolute;
  top: 70px;
  right: 12px;
  background: rgba(0,0,0,0.75);
  color: #0f0;
  padding: 8px 12px;
  border-radius: 10px;
  font-weight: bold;
  z-index: 1000;
}

/* Bottom Toolbar */
#toolbar {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(20,20,20,0.95);
  color: #fff;
  padding: 10px;
  z-index: 1000;
  border-top-left-radius: 16px;
  border-top-right-radius: 16px;
}

#toolbar button, #toolbar select {
  margin: 4px;
  padding: 8px 10px;
  border-radius: 8px;
  border: none;
}

#toolbar button {
  background: #1e88e5;
  color: white;
}

#toolbar select {
  background: #333;
  color: white;
}
</style>
</head>

<body>

<div id="map"></div>

<div id="infoBar">Detecting GPSâ€¦</div>
<div id="speed">Speed: 0 km/h</div>

<div id="toolbar">
  <select id="mapStyle">
    <option value="street">Street</option>
    <option value="satellite">Satellite</option>
    <option value="terrain">Terrain</option>
    <option value="dark">Dark</option>
  </select>

  <button onclick="addMarker()">Add Marker</button>
  <button onclick="clearMarkers()">Clear</button>
  <button onclick="toggleFollow()">Follow</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let map = L.map('map', { zoomControl: true }).setView([0,0], 2);
let followMode = true;
let markers = [];
let lastPos = null;
let distanceLine = null;

/* MAP LAYERS */
const layers = {
  street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
  satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
  terrain: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png'),
  dark: L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png')
};

layers.street.addTo(map);

/* MAP STYLE SWITCH */
document.getElementById('mapStyle').onchange = e => {
  Object.values(layers).forEach(l => map.removeLayer(l));
  layers[e.target.value].addTo(map);
};

/* GPS */
function startGPS(){
  if(!navigator.geolocation){
    document.getElementById('infoBar').textContent = 'GPS not supported';
    return;
  }

  navigator.geolocation.watchPosition(pos=>{
    const { latitude, longitude, altitude, speed } = pos.coords;

    document.getElementById('infoBar').innerHTML =
      `Lat: ${latitude.toFixed(6)} | Lng: ${longitude.toFixed(6)} | Alt: ${altitude ? altitude.toFixed(1)+' m' : '--'}`;

    document.getElementById('speed').textContent =
      `Speed: ${speed ? Math.round(speed*3.6) : 0} km/h`;

    if(!lastPos){
      map.setView([latitude, longitude], 18);
    }

    if(followMode){
      map.setView([latitude, longitude], map.getZoom());
    }

    lastPos = [latitude, longitude];
  },
  err=>{
    document.getElementById('infoBar').textContent = 'GPS blocked or denied';
  },
  {
    enableHighAccuracy: true,
    maximumAge: 0,
    timeout: 10000
  });
}

/* MARKERS & DISTANCE */
function addMarker(){
  if(!lastPos) return;

  const m = L.marker(lastPos).addTo(map);
  markers.push(m);

  if(markers.length >= 2){
    if(distanceLine) map.removeLayer(distanceLine);

    const p1 = markers[markers.length-2].getLatLng();
    const p2 = markers[markers.length-1].getLatLng();

    distanceLine = L.polyline([p1, p2], { color: 'red' }).addTo(map);
    const d = map.distance(p1, p2) / 1000;

    m.bindPopup(`Distance: ${d.toFixed(2)} km`).openPopup();
  }
}

function clearMarkers(){
  markers.forEach(m => map.removeLayer(m));
  markers = [];
  if(distanceLine) map.removeLayer(distanceLine);
}

/* FOLLOW MODE */
function toggleFollow(){
  followMode = !followMode;
}

/* AUTO START */
window.onload = () => {
  setTimeout(startGPS, 500);
};
</script>

</body>
</html>
